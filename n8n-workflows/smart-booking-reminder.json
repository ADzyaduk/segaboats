{
  "name": "–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 1
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "–ö–∞–∂–¥—ã–π —á–∞—Å",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [180, 300]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT b.id, b.\"customerName\", b.\"customerPhone\", b.\"startDate\", b.hours, b.\"totalPrice\", b.status, bt.name as \"boatName\", bt.pier, u.\"telegramId\" FROM booking b JOIN boat bt ON b.\"boatId\" = bt.id JOIN \"user\" u ON b.\"userId\" = u.id WHERE b.status IN ('CONFIRMED', 'PAID') AND b.\"startDate\" BETWEEN NOW() AND NOW() + INTERVAL '25 hours' AND b.\"startDate\" > NOW() + INTERVAL '23 hours'",
        "options": {}
      },
      "id": "get-upcoming-bookings",
      "name": "–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [400, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-boats",
          "name": "PostgreSQL Boats"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-results",
              "leftValue": "={{ $json.length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-has-bookings",
      "name": "–ï—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [620, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"openai/gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —è—Ö—Ç-–∫–ª—É–±–∞ '–Ø—Ö—Ç—ã –°–æ—á–∏'. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Ç—ë–ø–ª–æ–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–π –ø—Ä–æ–≥—É–ª–∫–µ –Ω–∞ —è—Ö—Ç–µ. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ. –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–º (3-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π).\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"–°–æ—Å—Ç–∞–≤—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ {{ $json.customerName }} –æ –ø—Ä–æ–≥—É–ª–∫–µ –Ω–∞ —è—Ö—Ç–µ '{{ $json.boatName }}' –∑–∞–≤—Ç—Ä–∞ –≤ {{ $json.startDate }}. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ $json.hours }} —á–∞—Å–æ–≤. –ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏: {{ $json.pier || '–±—É–¥–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–æ' }}.\"\n    }\n  ],\n  \"max_tokens\": 300,\n  \"temperature\": 0.7\n}",
        "options": {}
      },
      "id": "generate-ai-message",
      "name": "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI —Å–æ–æ–±—â–µ–Ω–∏—è",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [840, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "openrouter-auth",
          "name": "OpenRouter API"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞').item.json.telegramId }}",
        "text": "={{ $json.choices[0].message.content }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "send-telegram",
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1060, 200],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-telegram",
              "leftValue": "={{ $json.telegramId }}",
              "rightValue": "temp_",
              "operator": {
                "type": "string",
                "operation": "notStartsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "has-telegram",
      "name": "–ï—Å—Ç—å Telegram?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [840, 400]
    },
    {
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $env.TELEGRAM_ADMIN_CHAT_ID }}",
        "text": "üìã –ö–ª–∏–µ–Ω—Ç –±–µ–∑ Telegram:\n\nüë§ {{ $json.customerName }}\nüìû {{ $json.customerPhone }}\nüõ• {{ $json.boatName }}\nüìÖ {{ $json.startDate }}\n\n‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É",
        "additionalFields": {}
      },
      "id": "notify-admin-no-telegram",
      "name": "–£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∞",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1060, 400],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [840, 500]
    }
  ],
  "connections": {
    "–ö–∞–∂–¥—ã–π —á–∞—Å": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å Telegram?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å Telegram?": {
      "main": [
        [
          {
            "node": "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI —Å–æ–æ–±—â–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI —Å–æ–æ–±—â–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["booking", "reminder", "ai"],
  "triggerCount": 0,
  "updatedAt": "2026-01-21T10:00:00.000Z",
  "versionId": "1"
}
