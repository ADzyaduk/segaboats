{
  "name": "AI –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "booking-created",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-booking",
      "name": "Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [180, 300],
      "webhookId": "booking-created"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"openai/gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"–¢—ã - –º–µ–Ω–µ–¥–∂–µ—Ä —è—Ö—Ç-–∫–ª—É–±–∞ '–Ø—Ö—Ç—ã –°–æ—á–∏'. –°–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –Ω–æ–≤–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. –§–æ—Ä–º–∞—Ç: –¥–µ–ª–æ–≤–æ–π, –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π. –£–∫–∞–∂–∏ –∫–ª—é—á–µ–≤—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏. –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"–ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:\\n- –ö–ª–∏–µ–Ω—Ç: {{ $json.data.customerName }}\\n- –¢–µ–ª–µ—Ñ–æ–Ω: {{ $json.data.customerPhone }}\\n- –Ø—Ö—Ç–∞: {{ $json.data.boatName }}\\n- –î–∞—Ç–∞: {{ $json.data.startDate }}\\n- –ß–∞—Å–æ–≤: {{ $json.data.hours }}\\n- –°—É–º–º–∞: {{ $json.data.totalPrice }} —Ä—É–±.\\n\\n–°–æ—Å—Ç–∞–≤—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.\"\n    }\n  ],\n  \"max_tokens\": 400,\n  \"temperature\": 0.6\n}",
        "options": {}
      },
      "id": "ai-generate-admin-msg",
      "name": "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [400, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "openrouter-auth",
          "name": "OpenRouter API"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $env.TELEGRAM_ADMIN_CHAT_ID }}",
        "text": "={{ $json.choices[0].message.content }}\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìã ID: {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.bookingId }}\nüìû –°–≤—è–∑–∞—Ç—å—Å—è: {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.customerPhone }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "telegram-admin",
      "name": "Telegram: –ê–¥–º–∏–Ω—É",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [620, 300],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "has-telegram-id",
              "leftValue": "={{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.customerTelegramId }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            },
            {
              "id": "not-temp",
              "leftValue": "={{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.customerTelegramId }}",
              "rightValue": "temp_",
              "operator": {
                "type": "string",
                "operation": "notStartsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-customer-telegram",
      "name": "–ö–ª–∏–µ–Ω—Ç –≤ Telegram?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [840, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"openai/gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —è—Ö—Ç-–∫–ª—É–±–∞ '–Ø—Ö—Ç—ã –°–æ—á–∏'. –°–æ—Å—Ç–∞–≤—å —Ç—ë–ø–ª–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º. –£–ø–æ–º—è–Ω–∏ —á—Ç–æ —Å –Ω–∏–º —Å–≤—è–∂—É—Ç—Å—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏. –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"–ö–ª–∏–µ–Ω—Ç {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.customerName }} –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª —è—Ö—Ç—É '{{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.boatName }}' –Ω–∞ {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.startDate }}. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.hours }} —á–∞—Å–æ–≤. –°—Ç–æ–∏–º–æ—Å—Ç—å: {{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.totalPrice }} —Ä—É–±. –°–æ—Å—Ç–∞–≤—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.\"\n    }\n  ],\n  \"max_tokens\": 300,\n  \"temperature\": 0.7\n}",
        "options": {}
      },
      "id": "ai-generate-customer-msg",
      "name": "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1060, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "openrouter-auth",
          "name": "OpenRouter API"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ').item.json.data.customerTelegramId }}",
        "text": "={{ $json.choices[0].message.content }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "telegram-customer",
      "name": "Telegram: –ö–ª–∏–µ–Ω—Ç—É",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1280, 200],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"status\": \"success\", \"message\": \"Notifications sent\", \"adminNotified\": true, \"customerNotified\": $('–ö–ª–∏–µ–Ω—Ç –≤ Telegram?').item.json ? true : false } }}"
      },
      "id": "respond-webhook",
      "name": "–û—Ç–≤–µ—Ç Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1500, 300]
    },
    {
      "parameters": {},
      "id": "no-customer-telegram",
      "name": "–ù–µ—Ç Telegram",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1280, 400]
    }
  ],
  "connections": {
    "Webhook: –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ": {
      "main": [
        [
          {
            "node": "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞": {
      "main": [
        [
          {
            "node": "Telegram: –ê–¥–º–∏–Ω—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram: –ê–¥–º–∏–Ω—É": {
      "main": [
        [
          {
            "node": "–ö–ª–∏–µ–Ω—Ç –≤ Telegram?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–ª–∏–µ–Ω—Ç –≤ Telegram?": {
      "main": [
        [
          {
            "node": "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É": {
      "main": [
        [
          {
            "node": "Telegram: –ö–ª–∏–µ–Ω—Ç—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram: –ö–ª–∏–µ–Ω—Ç—É": {
      "main": [
        [
          {
            "node": "–û—Ç–≤–µ—Ç Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–µ—Ç Telegram": {
      "main": [
        [
          {
            "node": "–û—Ç–≤–µ—Ç Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["booking", "notification", "ai"],
  "triggerCount": 0,
  "updatedAt": "2026-01-21T10:00:00.000Z",
  "versionId": "1"
}
