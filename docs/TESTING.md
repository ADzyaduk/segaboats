# Руководство по тестированию

Этот документ описывает все доступные тесты для проекта Boats2026.

## Доступные тесты

### 1. API тесты (базовые)
```bash
npm run test:api
```
Проверяет базовую функциональность API:
- Health check
- Получение списка лодок
- Фильтрация по типу
- Получение одной лодки
- Валидация бронирований

### 2. Компоненты и отображение данных
```bash
npm run test:components
```
Проверяет отображение данных в компонентах и бизнес-логику:
- **BoatCard отображение:**
  - Вместимость (всегда показывает максимум 11 человек)
  - Рекомендуемая вместимость (если указана)
  - Длина и ширина лодки
  - Минимальное время аренды (от 1 часа)
  - Форматирование цены
  - Массивы features и images

- **Форма бронирования:**
  - Разрешение бронирования на 1 час
  - Проверка занятости времени
  - Обнаружение конфликтов при бронировании

- **Валидация данных:**
  - Все лодки имеют capacity = 11
  - recommendedCapacity < capacity (если указана)
  - Корректный формат всех полей

### 3. Полные тесты
```bash
npm run test:full
```
Комплексные тесты включающие:
- Health & Infrastructure
- Boats API (список, фильтры, детали)
- Bookings API (создание, валидация)
- Group Trips API
- Data Integrity
- Performance тесты

### 4. Все тесты
```bash
npm run test:all
```
Запускает все тесты последовательно.

## Что проверяют тесты

### Отображение данных в BoatCard

1. **Вместимость:**
   - Всегда показывается максимальная вместимость (capacity)
   - Если есть recommendedCapacity и она < capacity, показывается:
     - "до X гостей (рекомендуется) / до 11 гостей (максимум)"
   - Если нет recommendedCapacity, показывается:
     - "до 11 гостей"

2. **Размеры:**
   - Длина отображается с иконкой `i-heroicons-arrow-trending-up`
   - Ширина отображается с иконкой `i-heroicons-arrows-right-left` (если есть)
   - Формат: "X м" для длины, "Y м" для ширины

3. **Время аренды:**
   - Всегда показывается "Аренда от 1 часа"
   - Не зависит от minimumHours в базе данных

### Бронирование

1. **Минимальное время:**
   - Разрешено бронирование на 1 час
   - Валидация на сервере проверяет hours >= 1

2. **Проверка занятости:**
   - API возвращает bookedDates для каждой лодки
   - Проверка конфликтов при создании бронирования
   - Перекрывающиеся временные слоты отклоняются

3. **Валидация:**
   - Обязательные поля: boatId, startDate, hours, passengers, customerName, customerPhone
   - Формат телефона: +7 (900) 123-45-67
   - hours >= 1
   - passengers <= capacity

### Слайдоверы

Все слайдоверы должны открываться снизу (`side="bottom"`):
- Страница бронирования лодки (`/boats/[id]`)
- Страница групповых поездок (`/group-trips`)
- Страница услуг (`/group-trips/services/[type]`)
- Страница деталей поездки (`/group-trips/[id]`)

## Запуск тестов

### Требования
- Запущенный сервер разработки (`npm run dev`)
- База данных с seed данными (`npm run db:seed`)
- API доступен на `http://localhost:3003` (или указать через `API_URL`)

### Примеры

```bash
# Только API тесты
npm run test:api

# Только тесты компонентов
npm run test:components

# Все тесты
npm run test:all

# С кастомным URL
API_URL=http://localhost:3000 npm run test:components
```

## Структура тестов

```
scripts/
├── test-api.ts          # Базовые API тесты
├── test-components.ts   # Тесты компонентов и отображения
└── test-full.ts         # Полные комплексные тесты
```

## Добавление новых тестов

При добавлении новой функциональности:

1. **Для API endpoints:** Добавьте тест в `test-full.ts`
2. **Для компонентов:** Добавьте тест в `test-components.ts`
3. **Для UI логики:** Создайте отдельный файл или добавьте в `test-components.ts`

### Пример добавления теста:

```typescript
await test('Название теста', async () => {
  // Arrange
  const res = await fetch(`${API_URL}/api/endpoint`)
  
  // Act
  const data = await res.json()
  
  // Assert
  if (!data.success) throw new Error('Test failed')
  
  return { result: data.data }
})
```

## Отчеты

После выполнения тестов выводится:
- ✅ Успешные тесты
- ❌ Провалившиеся тесты с описанием ошибки
- ⚠️ Предупреждения
- Статистика: общее количество, пройдено, провалено
- Время выполнения каждого теста

## CI/CD

Тесты можно интегрировать в CI/CD pipeline:

```yaml
# Пример для GitHub Actions
- name: Run tests
  run: |
    npm run dev &
    sleep 5
    npm run test:all
```

## Отладка

Если тест падает:
1. Проверьте, что сервер запущен
2. Проверьте, что база данных заполнена (`npm run db:seed`)
3. Проверьте логи сервера
4. Проверьте формат данных в ответе API

## Покрытие

Текущие тесты покрывают:
- ✅ Все основные API endpoints
- ✅ Валидацию данных
- ✅ Бизнес-логику бронирований
- ✅ Отображение данных в компонентах
- ✅ Проверку конфликтов времени
- ✅ Форматирование данных
